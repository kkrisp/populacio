cmake_minimum_required(VERSION 3.0.0)
project(Populacio_projekt)

# definialjuk a verzioszamokat
set (Populacio_projekt_VERSION_MAJOR 1)
set (Populacio_projekt_VERSION_MINOR 0)

set (HEADER_LIB ${HEADER_LIB} ${PROJECT_SOURCE_DIR}/Fejek)
# modosit egy, mar letezo fajlt, 
configure_file (
  "${PROJECT_SOURCE_DIR}/Demo.hpp.in"
  "${PROJECT_BINARY_DIR}/Demo.hpp"    
  )

# az Animal.cpp-ben szerepel a to_string fuggveny,
# ami csak c++11 forditasi opcioval fordul le
add_compile_options(-std=c++11)

include_directories("${PROJECT_BINARY_DIR}") 
            # letrehoz egy adott mappat a build-ben

add_library(Animal Animal.cpp Animal.hpp)
add_library(Group Group.cpp Group.hpp Animal.hpp)
add_executable(PopSimExe Demo.cpp Demo.hpp)
target_link_libraries (PopSimExe Animal Group)

#install (TARGETS Demo DESTINATION bin)
#install (FILES Demo.hpp DESTINATION include)

# add the install targets
#install (TARGETS PopSimExe DESTINATION bin)
#install (FILES "${PROJECT_BINARY_DIR}/TutorialConfig.h"        
#         DESTINATION include)

# utasitas az elkeszult program futtataasara ...
add_custom_command (

  OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/asdasdasd.dat
  COMMAND PopSimExe
  DEPENDS PopSimExe
  )

# kiadjuk az elkeszult utasitast ...
add_custom_target(szim_futtatas ALL DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/asdasdasd.dat)

#add_dependencies(soapC vsphere_header)

find_package(Gnuplot)

# files to plot must have the extension .plot
# A pdf file is generated in the same directory
ADD_CUSTOM_TARGET(gnu_plottolas) #ALL DEPENDS popsim.dat)

ADD_DEPENDENCIES(gnu_plottolas szim_futtatas)

#IF(GNUPLOT)
  #SET(files count)
  #SET(results)
  #FOREACH(file ${files})
   #SET(src ${file}.plot)
   #SET(dst ${file}.pdf)
   ADD_CUSTOM_COMMAND(
      TARGET gnu_plottolas
      COMMAND ${GNUPLOT} ../popplot.p
      OUTPUTS ${dst}
      DEPENDS popsim.dat
   )
   #SET(results ${results} ${dst})
  #ENDFOREACH(file)
    
  #ADD_CUSTOM_COMMAND(
  #  TARGET gnu_plottolas
  #  COMMAND 
  #  DEPENDS ${results}
  #)
		  
#ENDIF(GNUPLOT)


include(UseLATEX.cmake)

add_latex_document(../master.tex
                   INPUTS ../master.tex
                   IMAGES build/eredmenyek.png
                   DEPENDS ../master.tex gnu_plottolas
                   TARGET_NAME dok
                   FORCE_PDF
                   )